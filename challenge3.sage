from hashlib import sha256

load("ecdsa.sage")

#Challenge 3
messages3 = [b'This is message number 0', b'This is message number 1', b'This is message number 2', b'This is message number 3', b'This is message number 4', b'This is message number 5', b'This is message number 6', b'This is message number 7', b'This is message number 8', b'This is message number 9', b'This is message number 10', b'This is message number 11', b'This is message number 12', b'This is message number 13', b'This is message number 14', b'This is message number 15', b'This is message number 16', b'This is message number 17', b'This is message number 18', b'This is message number 19']
signatures3 = [(1891061390910359406348761758649015995528204028581132464472309941639788797778788315608027220724034631014931937236993, 10806826769983118205519436167641899950725280582472608638735513392371584686384166893048743503471423724983188480476928), (1891061390910359406348761758649015995528204028581132464472309941639788797778788315608027220724034631014931937236993, 31156068534340446964191818354452555064802650555359431947869491274527449649976459673102144725614653482428587065977833), (1891061390910359406348761758649015995528204028581132464472309941639788797778788315608027220724034631014931937236993, 21592992290594833791987252370516877160869824763633022165425667730183075086076056348699109417442689940077274242252546), (1891061390910359406348761758649015995528204028581132464472309941639788797778788315608027220724034631014931937236993, 19082734236627043152662882983834387713190002857279679275635944025717469447086728210941432606141420959287892195163514), (1891061390910359406348761758649015995528204028581132464472309941639788797778788315608027220724034631014931937236993, 21714534515419694415127259961378629715221177173605605113668642842481122792063846084003176611079461503065067701961882), (1891061390910359406348761758649015995528204028581132464472309941639788797778788315608027220724034631014931937236993, 7091756170585099949689537074884836841675558516828960537612750485931154096801379724707153655753749534134171721078630), (1891061390910359406348761758649015995528204028581132464472309941639788797778788315608027220724034631014931937236993, 29266690718537796365222264728990837147401275153233621649103946666557220137266857371959272544635969684598193017089373), (1891061390910359406348761758649015995528204028581132464472309941639788797778788315608027220724034631014931937236993, 35313065213920359793859783816136021979767307482491298400079745565933691392694465021857497969678316518210551059263638), (1891061390910359406348761758649015995528204028581132464472309941639788797778788315608027220724034631014931937236993, 6499337405972909460444294428866921680505313705323256030032929059496627320290485324845834224339973359890255894426904), (1891061390910359406348761758649015995528204028581132464472309941639788797778788315608027220724034631014931937236993, 14000938842075027527975707765119922839578698914566224332704848547622780033673761041709465793731181336588590152829689), (1891061390910359406348761758649015995528204028581132464472309941639788797778788315608027220724034631014931937236993, 26536871063880625824883122836204271137453499096546727766452607448868225768396460310337930539931242037031488753112174), (1891061390910359406348761758649015995528204028581132464472309941639788797778788315608027220724034631014931937236993, 2903344096146112151361203229218997210953673156435025224151491220060811545960537661476923270946587157796871164807096), (1891061390910359406348761758649015995528204028581132464472309941639788797778788315608027220724034631014931937236993, 32189130070225448931799850791986880769528400249481003081617896393793418420786846672449175344774547446049755814080479), (1891061390910359406348761758649015995528204028581132464472309941639788797778788315608027220724034631014931937236993, 23844100615138644824753119615285071359496998314854854358340053925621726805557749734311472746073147571773191203261613), (1891061390910359406348761758649015995528204028581132464472309941639788797778788315608027220724034631014931937236993, 14132102865696363252496144988635861636795837556640496605495692537510479196125678600731590979743325608046063319867443), (1891061390910359406348761758649015995528204028581132464472309941639788797778788315608027220724034631014931937236993, 32840819882999759204128962367318930682256677090681515418679013565345524737302881838714105499169858092307603326319443), (1891061390910359406348761758649015995528204028581132464472309941639788797778788315608027220724034631014931937236993, 13356107828759955491563054193991849642932660967558823486363758512051237058590420769852318161658820385397109353745561), (1891061390910359406348761758649015995528204028581132464472309941639788797778788315608027220724034631014931937236993, 27419317342884423743238060084100586323909004016170589882199034951731011455015171240793104094953041556814593255915445), (1891061390910359406348761758649015995528204028581132464472309941639788797778788315608027220724034631014931937236993, 15652788081190180828528355972329584429708029340131453857266109731733080275532959145523245791714981548470324895929419), (1891061390910359406348761758649015995528204028581132464472309941639788797778788315608027220724034631014931937236993, 37858288569436942442032546621619988386166089414627981294778224595838692513383909823659556849057064810166465343026263)]
A = (35588517809648137129175323977187276202129491123975810843739834407602321942814333082202311699763587006726635006230524, 13102327084583633558752332215628618829045979731964244320046427848488601008255228583383911950340633573818070241085093)

(p, E, G, n) = params()

F = Integers(n)

# Hash des deux premiers messages, cela suffit
h1 = h(messages3[0])
h2 = h(messages3[1])

# Signatures (r, s)
r1, s1 = signatures3[0]
r2, s2 = signatures3[1]

# r est identique (car même nonce k)
assert r1 == r2
r = F(r1)
s1 = F(s1)
s2 = F(s2)

# Calcul du nonce k
num = F(h1 - h2)
den = F(s1 - s2)
k = num / den

# Calcul de la clé privée a
a = (s1 * k - F(h1)) / r
a = int(a)

print("Clé privée retrouvée :")
print("a =", a)

# Vérification : a * G == A ?
A_calcule = (a * G).xy()
print("Clé publique calculée :", A_calcule)
print("Clé publique attendue  :", A)

if A_calcule == A:
    print("Clé privée vérifiée avec succès.")
else:
    print("Clé publique ne correspond pas.")